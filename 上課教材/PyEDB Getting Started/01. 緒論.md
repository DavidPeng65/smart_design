第1章 緒論
---
電路板（PCB）是一個複雜且多層次的系統，由多種類型的結構組成，其設計與製造涉及大量的元件、層次、和互連技術。首先，PCB 通常由多層導電層和絕緣層交替堆疊而成，這些層數可以從幾層到數十層不等，以便滿足不同電路的電氣需求與佈局複雜度。每一層的導電結構通常包括信號走線、電源和接地層，這些結構的設計對於信號完整性（SI）、電源完整性(PI)和電磁相容性（EMC）至關重要。

電路板還包含了大量的電子元件，如電容、電感、晶體管、IC 等，這些元件通過焊點或過孔與電路板上的走線互連，形成一個完整的電路系統。過孔是將不同層次連接起來的關鍵，它們有穿通、盲孔和埋孔三種類型，這些過孔的設計在信號的傳輸路徑和抗干擾能力上有著重要影響。此外，走線的寬度、間距、轉彎方式等都需要精確設計，以確保信號傳輸的質量，尤其是在高速電路中，任何一點的失誤都可能引起反射或串擾，進而影響整個系統的性能。

![2024-10-15_14-24-48](/assets/2024-10-15_14-24-48.png)

為了應對這些複雜性，電路板設計往往需要考慮多方面的因素，包括功率分佈、熱管理、結構穩定性等。設計過程中，還需要多次進行電氣和熱的模擬，以保證其能在實際應用中穩定運行。因此，PCB 的設計是一項多學科協作的工程，涉及電磁學、材料科學以及製造工藝等多方面知識，最終形成一個高效、可靠的電子系統。

ANSYS EDB (Electronics Database File) 是一種專有的檔案格式，專門用於儲存印刷電路板（PCB）和電子封裝設計的相關資料，主要應用於 ANSYS 的 HFSS 3D Layout 和 SIwave 工具中，以支援設計模擬與分析。這種格式能夠儲存從幾何結構到電性參數的完整信息，並且可以被 Python 及 PyAEDT 等 API 用於自動化的仿真過程中。

與一般 PCB 的檔案格式有顯著差異，EDB 格式特別針對高頻電性模擬進行了優化，包含更多關鍵訊息，例如蝕刻（etch）、導體表面的粗糙度（roughness）、頻率相關材料（frequency dependent material）的特性、端口（ports）設置、模擬設置（setup）、以及頻率掃描（sweep）等。這些額外資訊能夠支持更精確的高頻行為分析，使得 EDB 格式在高頻電性分析和模擬上具有明顯的優勢。

除了 PCB，EDB 結構也可以用來定義封裝相關，例如鍵合線（bondwires）、凸塊（bump）、引線框架（leadframe）、矽穿孔（TSV）、重分佈層（RDL）、電氣過孔（vias）等，這些訊息能夠完整地保存在 EDB 格式中，以支援更精確的封裝設計和模擬需求。

EDB 可以支援多個 cell，並定義這些 cell 之間的連接。例如，P cell 代表封裝基板，C cell 代表 CPU，而 M1、M2、M3、M4 cells 代表記憶體。訊號從 CPU 經過封裝基板，再連接到堆疊的記憶體晶片。在 S cell（system cell）中，可以將以上所有 cell 結合成一個完整的互聯結構，以模擬系統的完整互聯特性，可進行 SI（信號完整性）、PI（電源完整性）甚至熱模擬（Thermal simulation）。

### 1.1 EDB 檔案介紹
EDB (Electromagnetic Database) 檔案是 ANSYS Electronics Desktop (AEDT) 的一部分，主要用於儲存電路板設計的電磁結構和相關數據。以下是對 EDB 檔案的詳細介紹：

#### 包含資訊
EDB 檔案包含以下關鍵資訊：
 
- **幾何結構** ：包括電路板的形狀、圖層、銅箔路徑、焊塊、開槽和孔洞等。這些元素是 PCB 設計的基礎，決定了板子的最終形狀和導電特性。
 
- **電氣元件** ：提供電容、電阻、IC 封裝等元件的位置信息、型號及參數配置，這些資訊對設計和模擬至關重要。
 
- **信號和電源網路** ：描述電路中各種信號和電源的分佈與連接方式，是進行信號完整性（SI）和電源完整性（PI）分析的核心資料。
 
- **材料屬性** ：定義每個圖層的材料屬性，例如介電常數、導電性和損耗因子，影響信號傳播速度、損耗及散熱性能。
 
- **電磁模擬設置** ：包括邊界條件、激勵源等設定，如激勵信號的頻率範圍和邊界層設置，這些設定對模擬的準確性和效率至關重要。

#### 用途 

EDB 檔案的主要用途包括：
 
- **PCB 設計與分析整合** ：將 PCB 設計數據（如幾何結構、材料、元件）與分析設置整合，便於在 ANSYS AEDT 中進行電磁、熱等多物理場模擬，減少數據轉換錯誤並節省時間。
 
- **設計自動化** ：透過 PyAEDT 或 Python 腳本，實現設計流程自動化，例如優化網路、檢查阻抗匹配或批量處理，從而提高效率並減少人為錯誤。
 
- **多物理場聯合分析** ：支持電磁-熱聯合模擬，評估元件在運行過程中的發熱情況及其對電氣性能的影響，有助於在設計初期考慮熱管理問題，特別對於高性能設計尤為重要。

#### 檔案結構 

EDB 檔案的 .aedb 目錄包含以下主要文件或文件夾：
 
- **stride 文件夾** ：包含與特定設計版本有關的數據，通常用於組織和存儲不同設計階段的臨時數據，確保設計過程的可追溯性。
 
- **edb.def 文件** ：定義電子數據庫中設定參數的文件，用於保存設計的定義，便於重用或修改設計，減少重複工作及維護成本。

![2024-08-20_09-23-59](/assets/2024-08-20_09-23-59.png)


#### 格式轉換 

EDB 檔案可以由其他設計格式轉換：
 
- **ODB++** ：支援 ODB++ 格式的輸入和輸出，該格式是 PCB 製造和裝配的常見標準，確保設計到製造過程中的數據一致性。
 
- **IPC-2581** ：支持輸入或輸出 IPC-2581 格式，這是另一種設計到製造的標準格式，有助於減少設計與製造之間的溝通錯誤。
 
- **BRD** ：支援 BRD 格式的轉換，該格式用於與其他 CAD 工具之間進行數據交換，便於不同設計平台間的合作。

### 1.2 PyEDB 簡介

`pyedb` 是 ANSYS 提供的一個 Python API，用於 AEDT 的 EDB（Electronics DataBase）數據庫操作，讓工程師可以更靈活地進行電路設計和模擬。

以下是一些應用情境中的常見功能：
 
1. **參數化設計** ：使用 pyedb 可以輕鬆地進行設計參數化操作，例如自動修改 PCB 上的元件參數、佈局，並運行批量模擬以便找到最佳設計解決方案。
 
2. **設計數據的查詢和處理** ：通過 pyedb，可以查詢電路中的各種元件、網路和層的資料，並進行編程處理。這非常適合用於設計審查過程，例如快速定位某些元件或者校驗佈局的設計規則。
 
3. **自動化電磁分析準備** ：許多高頻電路和 PCB 設計需要進行電磁模擬分析，通過 pyedb，可以批量地對設計進行設置和調整，從而減少手動配置的工作量。例如，設置模擬邊界條件、端口或者頻段等，都可以自動化處理。
 
4. **與其他工具的整合** ：由於 Python 是一個非常靈活的編程語言，pyedb 可以與其他分析工具（例如 optiSLang、機器學習工具庫等）整合使用，使得可以根據模擬結果自動進行後續的設計調整，或進行更深入的數據分析。

### 1.3 PyAEDT 簡介
PyEDB 可以高效地完成 PCB 或封裝的前處理並生成模型，然而進行模擬和數據處理則需要使用 AEDT（ANSYS Electronics Desktop）。AEDT 同樣可以透過 Python 進行控制，而 PyAEDT 則是其中的關鍵工具，可以用來執行模擬並提取模擬結果數據。這種分工使得從前處理到模擬再到數據分析的整個流程能夠被完全自動化，大幅提高了效率並減少了手動操作的錯誤風險。

PyAEDT 是 Ansys 提供的 Python 庫，用於自動化 Ansys Electronics Desktop (AEDT) 的多個工具。它允許用戶在 Python 環境中操作和控制 AEDT，而無需打開圖形用戶界面，是進行電子設計模擬自動化和提高工作效率的利器。

```mermaid
graph LR
    A[PyEDB/建模] --EDB--> B[PyAEDT/模擬] --模擬結果--> C[Python/資料分析]
```

PyAEDT 支持多個模塊，包括 HFSS、Circuit、Icepak 等。而其中 **Hfss3DLayout**  模塊是 PyAEDT 的重要部分，專門用於處理和模擬複雜的 PCB、封裝和其他高頻佈局結構。**Hfss3DLayout 的主要功能與應用：**  
1. **佈局設計的高效管理：** 
  - Hfss3DLayout 專門用於處理三維佈局設計。它允許用戶通過 PyAEDT 對 PCB 和封裝的結構進行操作，比如創建導體圖層、定義過孔、設置網絡等。

  - 用戶可以自動地進行設計佈局的修改，這在進行佈局設計優化和快速迭代時尤為重要。例如，在佈局中插入新的過孔、調整走線，這些操作都可以通過腳本完成。
 
2. **參數化模擬設置：** 
  - Hfss3DLayout 支持參數化設計，這意味著可以設定變量來代表佈局中的特定設計參數（如走線寬度、過孔直徑等），從而進行參數掃描和優化。

  - 例如，可以自動化地設置參數化走線的寬度，然後對其進行 S 參數模擬，以評估不同寬度對信號完整性的影響。
 
3. **電磁模擬自動化：** 
  - PyAEDT 可以讓用戶從頭開始設置 Hfss3DLayout 的模擬過程，包括設置模擬域、端口定義、邊界條件、頻率範圍等。

  - 通過 Python 腳本，可以批量執行多次模擬並擷取結果，這對於進行設計優化和敏感度分析非常有幫助。例如，可以自動化地為 PCB 中的不同信號線定義端口並進行 S 參數模擬。
 
4. **結果擷取與數據分析：** 
  - Hfss3DLayout 不僅可以進行電磁場模擬，還可以通過 PyAEDT 將模擬結果擷取出來，進行後續的數據處理。

  - 例如，可以自動化地擷取 S 參數，並使用 Python 的數據分析工具（如 Pandas、Matplotlib）進行可視化，這樣可以快速發現設計中可能的問題。
 
5. **與其他工具的無縫整合：** 
  - PyAEDT 提供的 Hfss3DLayout 還可以與 optiSLang 等工具整合，用於優化設計流程。例如，通過 optiSLang 進行全局優化和敏感度分析，可以顯著提升設計的性能。

  - 另外，Hfss3DLayout 可以與其他模擬工具（如 Icepak）聯動，進行跨物理場（如熱電耦合）分析，以提高產品的可靠性。


### 1.4 應用案例
透過 PyEDB，使用者能夠以程式化的方式讀取和修改 PCB 設計中的幾何結構、材料屬性和電氣元件等關鍵資訊。這樣可以自動化分析流程，

#### 信號完整性分析
對於信號完整性（Signal Integrity, SI）工程師而言，提取特定網路的 S 參數模型是一項常見的任務。通過程式化的方式來實現此任務，工程師只需指定新的電路板檔案，接下來所有的流程都可以自動完成。

在此過程中，程式可以自動將電路板檔案導入到 HFSS 3D Layout，選擇相應的網路，並切割合適的區域進行模擬。同時，自動設定端口、邊界條件，並依據需求設定模擬的頻率範圍和收斂條件。模擬結束後，程式還會自動收集結果數據並生成報告，極大地減少了手動處理的負擔。

透過這種自動化工作流程，SI 工程師能顯著提升效率。每次電路板變更時，僅需更新檔案路徑即可，避免繁瑣的手動設置步驟。這種方式不僅省時高效，還能降低手動操作帶來的錯誤風險，在快速變動的設計開發環境中尤為實用和有價值。

![2024-10-16_03-57-33](/assets/2024-10-16_03-57-33_4nazm451y.png)

#### 設計探索

在信號完整性（SI）設計中，工程師常需考量 via 陣列結構的阻抗及其對干擾的控制。然而，via 的設計與分析通常依賴於特定的電路板堆疊與電源/地平面的配置，這無疑增加了設計和分析的複雜性。

在傳統流程中，PCB 佈線工程師會先完成電路板設計，然後將其交由模擬工程師進行分析。如果模擬過程中發現問題，則需要回到 PCB 佈線階段重新修改，然後再進行模擬，這樣的流程不僅耗時且低效。此外，依賴人工操作難以保證設計優化，並可能導致無法達到最佳結果。

通過自動化程式來處理模擬設置和分析，可以在設計早期便進行 via 陣列結構的模擬與優化，確保阻抗和干擾控制達到預期效果，而不必等到佈線完成後再進行修改。這不僅加速了設計迭代流程，也能及時發現並解決潛在問題，有效提高開發效率，減少修改次數，實現自動化的優化設計。

![2024-10-16_03-55-06](/assets/2024-10-16_03-55-06.png)