現代工程軟體的開發流程
---


### 前言：為何需要標準化開發流程？

在上一章中，我們探討了 GUI 設計的原則與架構。然而，一個卓越的設計理念要轉化為一個穩定、可維護且功能強大的軟體產品，需要一個嚴謹且高效的開發流程來支撐。

在現代軟體工程中，「開發流程」早已超越了單純「編寫程式碼」的範疇。它是一個涵蓋了從概念發想、環境建構、團隊協作、版本控制、自動化測試、AI 輔助、到最終部署與後期維護的完整生命週期管理。

一個定義良好的開發流程能帶來諸多益處：

1.  **可預測性**：使專案進度可被追蹤，風險可被識別。
2.  **品質保證**：通過標準化的審查（Review）和測試流程，確保程式碼品質。
3.  **可維護性**：清晰的架構和版本紀錄，使未來的修改和功能擴展變得容易。
4.  **協同效率**：為團隊成員（包括 AI Agent）提供一個共同的工作框架，減少溝通成本和開發衝突。

本章節將詳細介紹一個整合了版本控制、虛擬環境、AI 協同開發與自動化部署的現代化開發流程。

-----

### 1\. 階段一：初始化開發環境

一個穩固的起點是專案成功的基石。在編寫任何業務邏輯之前，建立一個標準化、可複製且隔離的開發環境是首要任務。

#### 1.1 建立版本控制倉庫 (Git)

版本控制系統（Version Control System, VCS）是現代開發的「時光機」與「協作中心」。Git 是目前業界的絕對標準。

  * **執行 `git init`**：
    在專案的根目錄下執行 `git init` 指令，是開啟版本控制的第一步。此指令會建立一個新的 Git 倉庫，並在該目錄下創建一個隱藏的 `.git` 子目錄。這個 `.git` 目錄包含了 Git 用來儲存版本歷史、配置訊息、分支訊息等所有元數據（Metadata）的核心資料庫。從這一刻起，專案目錄下的所有文件變更都將可以被 Git 追蹤。

  * **配置 `.gitignore` 文件**：
    `git init` 之後，應立即在根目錄建立一個名為 `.gitignore` 的文件。此文件的作用是告知 Git *忽略* 某些特定的文件或目錄，不要將它們納入版本控制。這至關重要，因為有許多文件是不應該（也不需要）被提交到倉庫中的，例如：

      * **虛擬環境目錄**：如 `.venv/` 或 `env/`。
      * **Python 緩存文件**：如 `__pycache__/`、`*.pyc`。
      * **IDE/編輯器配置文件**：如 `.vscode/`、`.idea/`、`.DS_Store`。
      * **本地配置文件**：如包含密碼或 API 金鑰的 `config.ini`（應使用模板）。
      * **日誌與構建產物**：如 `.log` 文件、`dist/`、`build/`。

    一個良好的 `.gitignore` 範本能確保倉庫保持乾淨，只包含必要的原始碼和配置文件。

#### 1.2 建立隔離的 Python 虛擬環境

工程模擬軟體往往依賴眾多第三方 Python 套件（如 PySide6, NumPy, Matplotlib 等）。在系統全域環境中安裝這些套件會導致「依賴地獄」（Dependency Hell）——不同專案可能需要同一套件的不同版本，從而產生衝突。

  * **建立虛擬環境 (`.venv`)**：
    虛擬環境的目的是為每個專案創建一個獨立、隔離的 Python 運行環境。

    ```bash
    # 在專案根目錄執行
    python -m venv .venv
    ```

    此指令會創建一個名為 `.venv` 的目錄，其中包含一個獨立的 Python 解釋器副本以及 `site-packages` 目錄，用於存放此專案專屬的依賴包。

  * **啟動虛擬環境**：
    環境建立後，必須「啟動」它才能生效：

    ```bash
    # Windows (CMD/PowerShell)
    .\.venv\Scripts\activate

    # macOS / Linux (Bash)
    source .venv/bin/activate
    ```

    啟動後，終端提示符通常會顯示 `(.venv)` 前綴，表示當前所有 `python` 和 `pip` 指令都將在此隔離環境中執行。

#### 1.3 依賴管理 (`requirements.txt`)

  * **安裝依賴**：
    在虛擬環境啟動狀態下，使用 `pip install` 安裝所有必要的套件，例如 `pip install pyside6 numpy`。

  * **凍結依賴版本**：
    當專案開發到一個穩定階段或準備部署時，必須記錄下當前環境中所有依賴包的確切版本，以確保其他開發者或部署伺服器能 100% 複製此環境。

    ```bash
    pip freeze > requirements.txt
    ```

    此指令會生成 `requirements.txt` 文件，內容類似：

    ```
    pyside6==6.5.0
    numpy==1.26.1
    ...
    ```

    這個 `requirements.txt` 文件**必須**被提交到 Git 倉庫中。其他人在下載專案後，只需執行 `pip install -r requirements.txt` 即可安裝所有相同版本的依賴。

#### 1.4 建立架構設計文件 (`architecture.md`)

在開始大規模編碼前，應建立一個 `architecture.md` 文件（使用 Markdown 格式便於閱讀和版本控制）。此文件是專案的「架構藍圖」，是團隊成員（包括 AI Agent）對專案設計達成共識的基礎。

此文件應至少包含：

1.  **專案目標**：高層次的需求描述。
2.  **核心架構**：採用何種設計模式，例如上一章提到的 MVC 架構。
3.  **技術選型**：明確列出關鍵技術（如 PySide6, PyTest, SQLite）及其原因。
4.  **模組劃分**：定義主要程式碼目錄結構（如 `/gui`, `/core`, `/scripts`）及各自職責。
5.  **數據流圖**：簡述數據如何在系統中流動（例如：用戶點擊 -\> Controller -\> Model -\> 後端腳本 -\> Model 更新 -\> View 刷新）。

此文件應與專案一同演進，並被 Git 納入版本控制。

-----

### 2\. 階段二：AI 協同開發模式

隨著大型語言模型（LLM）的發展，AI Agent 正在從一個「工具」轉變為一個「開發夥伴」。在 CLI（Command Line Interface，命令行界面）或專用 IDE 中啟動 AI Agent，可以極大地加速開發進程，但這需要一套新的互動模式。

#### 2.1 啟動對話：上下文注入

AI Agent 的能力強弱，高度依賴於開發者為其提供的「上下文」（Context）。

  * **提供架構藍圖**：
    互動的第一步，應是讓 AI 完整閱讀 `architecture.md` 文件以及專案的當前目錄結構。
  * **複述需求與目標**：
    關鍵步驟：要求 AI 用自己的語言「複述（Paraphrase）」當前的專案目標、架構設計和接下來要實現的具體需求。例如：「根據 `architecture.md`，我們的目標是構建一個 MVC 架構的 GUI，目前我需要你協助我實現 View 中的日誌窗口。請確認你的理解。」
  * **確認理解**：
    開發者必須仔細評估 AI 的複述。如果 AI 的理解有偏差（例如，它誤解了 MVC 中 Model 和 View 的職責），必須立即糾正。這個初始校準步驟可以避免後續生成大量無用或錯誤的程式碼。

#### 2.2 探索式提問與方案評估

在需求明確後，應採用蘇格拉底式的提問法，與 AI 共同探索最佳實現方案。

以「訊息視窗需要用不同顏色區分訊息類型（如 Info, Warning, Error）」為例，開發者不應直接說「給我程式碼」，而應提問：

> 「在 PySide6 中，如果要讓一個 `QTextEdit` 視窗能用不同顏色（例如：Info-藍色, Warning-橘色, Error-紅色）來顯示不同類型的日誌訊息，有哪些實現方式？請分析它們的優劣、可行性，以及需要注意的事項。」

一個優秀的 AI Agent 應能提供多種方案：

1.  **方案一：`setTextColor()`**
      * **描述**：在插入文本前，調用 `QTextEdit.setTextColor()` 設置顏色。
      * **優點**：最簡單，易於理解。
      * **缺點**：如果日誌是異步刷新的，顏色設置和文本插入的狀態管理會變得很混亂。
2.  **方案二：HTML 子集**
      * **描述**：使用 `QTextEdit.appendHtml()` 方法，插入帶有 `style` 或 `<font>` 標籤的 HTML 字符串。
      * **優點**：靈活性高，不僅能改顏色，還能改字體、加粗等。
      * **缺點**：需要手動轉義日誌中的特殊字符（\<, \>），否則可能導致 HTML 渲染錯誤。
3.  **方案三：`QSyntaxHighlighter`**
      * **描述**：繼承 `QSyntaxHighlighter` 類，並將其實例附加到 `QTextEdit` 的文檔上。通過正則表達式來實時格式化文本。
      * **優點**：高度解耦，日誌系統只需專注於輸出純文本（如 `[ERROR] message`），高亮器自動負責渲染。
      * **缺點**：實現相對複雜，正則表達式可能有效率問題。

通過這種方式，開發者可以基於 AI 提供的分析，做出符合專案架構（例如，方案二或三更符合 MVC 的解耦思想）的技術決策。

#### 2.3 澄清與修正的閉環

在 AI 互動過程中，雙向溝通至關重要。

  * **指正 AI 的錯誤**：如果 AI 提供的程式碼不符合需求（例如，使用了已棄用的 API，或者忽略了 `architecture.md` 中關於異步處理的約定），開發者必須明確指出：「你的建議使用了 `QTextEdit.append()`，但這在多線程中可能不安全。根據我們的架構，日誌應通過 Qt 的 Signal/Slot 機制從工作線程發送到 GUI 線程。請重構你的方案以使用信號槽。」
  * **漸進式開發**：讓 AI 專注於小而具體的任務，而不是一次性生成整個模組。

這個「提問-分析-決策-澄清-修正」的循環，確保了 AI 始終在正確的軌道上協助開發，也使得開發者能持續判斷 AI 是否真正理解了專案的深層需求。

-----

### 3\. 階段三：現代化版本控制與專案管理

Git 不僅是備份工具，更是團隊協作和品質控制的核心。在 AI 協同開發模式下，Git 的重要性更為凸顯。

#### 3.1 Git 核心工作流：分支管理

專案應採用結構化的分支模型，以隔離不同的開發任務，確保主分支的穩定性。一個常見且高效的模型是 Git Flow 的簡化版：

  * **`main` (或 `master`) 分支**：
    此分支代表「生產就緒」的程式碼。任何時候 `main` 分支上的程式碼都應是可部署的、經過充分測試的穩定版本。不允許直接在此分支上進行開發。
  * **`develop` 分支**：
    作為開發的「整合」分支。所有新功能開發完成後，應合併（Merge）到此分支進行整合測試。
  * **功能分支 (Feature Branches)**：
    這是所有開發工作的起點。當需要開發一個新功能（例如，`feat/colored-logging`）或修復一個錯誤（例如，`fix/crash-on-import`）時，應**始終**從 `develop` 分支創建一個新的功能分支。

#### 3.2 AI 協同開發的 Git 實踐

將 AI Agent 納入開發流程時，版本控制提供了一個至關重要的「安全網」。

1.  **提交變更（Commit）**：

      * **原子化提交**：應養成「小步快跑」的提交習慣。每次提交（Commit）都應代表一個獨立、完整的邏輯單元（例如，「實現日誌 HTML 格式化」，而不是「修改了幾個文件」）。
      * **清晰的提交訊息**：撰寫清晰的提交訊息（Commit Message）至關重要。推薦使用「[Conventional Commits](https://www.conventionalcommits.org/en/v1.0.0/)」規範，例如：
          * `feat: add colored logging using HTML` (新功能)
          * `fix: escape special characters in log messages` (修復錯誤)
          * `refactor: move logging logic to LogController` (程式碼重構)
          * `docs: update architecture.md with logging details` (文件變更)

2.  **AI 變更的審查（Review）**：
    **核心原則：開發者永遠是程式碼的最終負責人。**
    當 AI Agent 產生了一段程式碼，開發者必須扮演「審查者」（Reviewer）的角色。

      * **程式碼審查**：在接受 AI 的變更前，必須仔SQL細審查其風格是否一致、邏輯是否正确、是否隱藏安全漏洞、是否符合 `architecture.md` 的架構約束。
      * **Diff 工具**：使用 `git diff` 或 Git Desktop 等圖形化工具，清晰地查看 AI 到底「修改」、「新增」或「刪除」了哪些行。

3.  **測試（Test）**：
    AI 生成的程式碼必須經過與人類編寫的程式碼同樣嚴格的測試。在將變更提交（Commit）到功能分支之前，必須在本地運行相關的測試（單元測試、整合測試、手動測試），確保新程式碼不會引入新的錯誤（Regression）。

4.  **合併（Merge）**：
    當功能分支（例如 `feat/colored-logging`）上的開發和測試均已完成，開發者應將其合併回 `develop` 分支。此過程通常通過「合併請求」（Merge Request, MR）或「拉取請求」（Pull Request, PR）來完成，這為團隊其他成員提供了在合併前進行最終審查的機會。

#### 3.3 處理 AI 誤解：Discard 功能

AI 並非完美，它可能因上下文不足或理解偏差而產生完全不符合預期的程式碼。

  * **善用 Discard**：
    如果發現 AI 生成的變更方向完全錯誤（例如，它為了實現日誌高亮，擅自修改了與之無關的核心模擬器腳本），此時不應試圖在錯誤的基礎上修補。
    開發者應利用 Git 的「Discard」（丟棄）功能，例如 `git checkout -- .` 或使用 Git Desktop 的「Discard Changes」按鈕，將工作區的修改捨棄，**一鍵回到修改前的乾淨狀態**。

  * **重新校準**：
    Discard 之後，必須回到階段二的「AI 協同開發模式」，重新進行需求確認和設計討論。向 AI 解釋為何其先前的方案是不可接受的（例如：「你修改了 `core/solver.py`，但根據架構，View 層的變更絕不能影響 Core 層。請重新思考方案。」），以確保 AI 能夠在正確的約束下重新生成程式碼。

#### 3.4 圖形化工具：Git Desktop

對於不熟悉 Git 命令行的開發者，Git Desktop 是一個優秀的圖形化工具。它將抽象的 Git 概念可視化，極大降低了使用門檻：

  * **可視化變更（Diffs）**：直觀地以紅綠色塊顯示程式碼的增刪。
  * **分支管理**：輕鬆切換、創建和合併分支。
  * **提交歷史**：以時間線方式清晰展現專案的發展歷程。

使用 Git Desktop 可以讓開發者更專注於程式碼的邏輯，而不是記憶複雜的 Git 指令，從而提升專案管理的效率和便利性。

-----

### 4\. 階段四：部署、交付與持續維護

開發流程的最後一環是將軟體交付給最終用戶，並確保其在不同環境中都能穩定運行。

#### 4.1 部署的一致性：`.venv` 與 `requirements.txt`

  * **虛擬環境的隔離**：在部署階段，`.venv` 虛擬環境的核心價值在於確保部署環境（例如用戶的電腦或伺服器）的純淨性。通過在目標機器上創建一個新的虛擬環境並使用 `requirements.txt` 安裝依賴，可以保證應用程式的運行環境與開發環境完全一致，避免了「在我的電腦上可以跑」的典型問題。
  * **`requirements.txt` 的重要性**：此文件是部署的「物料清單」。在部署前，應再次確認所有必要的依賴包（包括其正確的版本號）都已包含在內。

#### 4.2 自動化部署腳本 (`install.bat`)

為了簡化用戶的安裝過程並確保每次部署的一致性，應提供自動化部署腳本。

  * **Windows 批處理 (`install.bat`)**：
    對於 Windows 用戶，可以提供一個 `install.bat` 腳本。此腳本應自動執行以下步驟：

    1.  檢查 Python 是否已安裝。
    2.  創建 `.venv` 虛擬環境 (`python -m venv .venv`)。
    3.  啟動虛擬環境並安裝所有依賴 (`.\.venv\Scripts\pip.exe install -r requirements.txt`)。
    4.  （可選）在桌面創建一個啟動應用的快捷方式。

  * **跨平台腳本 (`install.sh`)**：
    對於 macOS 或 Linux 用戶，應提供一個等效的 `install.sh` 腳本。

    這些腳本將繁瑣的手動步驟自動化，極大降低了用戶的使用門檻。

#### 4.3 應用程式打包（Packaging）

對於非開發背景的終端用戶，要求他們運行 Python 腳本是不切實際的。開發流程的最終交付產物應該是一個獨立的可執行文件（如 `.exe`）。

  * **使用 `PyInstaller` 或 `cx_Freeze`**：
    這類工具可以將 Python 解釋器、專案原始碼以及 `.venv` 中的所有依賴包，全部打包成一個（或一組）獨立的可執行文件。
  * **優勢**：用戶無需安裝 Python 或任何依賴，只需雙擊 `.exe` 文件即可運行 GUI 應用程式。這才是真正專業的軟體交付形態。

#### 4.4 持續維護

軟體交付並不是流程的終點。隨著用戶的反饋和需求的變更，專案將進入持續維護階段。

  * **錯誤修復**：用戶報告 Bug，開發者創建 `fix/reported-bug` 分支。
  * **功能增強**：規劃新功能，開發者創建 `feat/new-feature` 分支。

這個過程將無縫地迴歸到本章節所述的階段二（AI 協同開發）和階段三（版本控制），形成一個不斷迭代、不斷完善的開發生命週期。

### 總結

一個現代化的開發流程是一個融合了**嚴謹初始化**（Git, venv）、**智能協同**（AI Agent）、**規範化管理**（分支, 審查）和**自動化交付**（腳本, 打包）的有機整體。遵循這一流程，開發團隊（無論是人類還是 AI）才能高效協作，打造出高品質、易維護、可擴展的工程模擬軟體。