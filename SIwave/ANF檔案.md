.ANF 格式在 SIwave 中作為除錯手段的技術應用
---

.ANF（Ansoft Neutral File）是 Ansys 早期定義的中立資料格式，最初用於在不同電磁模擬工具間傳遞 PCB 設計資料。其內容主要包含幾何結構、導線走線（nets）、針腳（pins）等基本設計資訊，格式簡潔、可讀性高，適合用於資料轉換與設計簡化。在 SIwave 的發展歷程中，雖然現今主流格式已轉為 EDB，但 ANF 因其結構單純、避免冗餘，依然在特定除錯場景中扮演重要角色。

雖然 .ANF (英文全名: Ansoft Neutral File)已經被視為較舊代的設計資料格式，但在現代版 SIwave 應用中，.ANF 仍然擁有一項很強大的技術功能：用於“重置設計結構與除錯”。

本文將分析 ANF 格式與 EDB 格式之間的差異，並說明在那些情境下，利用 ANF 作為中線格式，能夠有效解決 SIwave 模擬失敗或異常的問題。


### 一、ANF 與 EDB 格式比較

| 項目   | .ANF            | .EDB                    |
| ---- | --------------- | ----------------------- |
| 支援資料 | 基本底圖、net、pin    | 全面：含材料、成分、層堆            |
| 層堆設定 | 限制的層、底圖說明       | 可統一管理層項與材料屬性            |
| 元件模型 | 主要是 footprint | 支援 SPICE/S-parameter 連線 |
| 處理效率 | 較簡潔             | 資料複雜易出現錯誤               |


EDB 是 SIwave 、HFSS 3D Layout 、Q3D 等 Ansys 系列軟體的原生格式，擁有全資料檔、可跟自動化軟體連接，最適合從電設計分析一路導致結果解析。

但是此格式也正因為其資料豐富、關聯性複雜，在進行設計擴充、參數實驗、或跨工具格式轉換（如從 PCB Layout 工具至 SIwave）時，若有任何模擬設定上的疏漏或資料殘留，極易發生無明確錯誤訊息的模擬失敗。例如最常見的錯誤之一是 "memory access violation"，這類錯誤可能來自堆疊不一致、網格建構異常、或多餘隱藏元件未被清除，導致 SIwave 模擬器在初始化階段即崩潰，且無法於 GUI 中直接診斷。


### 二、利用.anf除錯：利用 ANF 重建設計

當你遇到 SIwave 已完全設定好，卻在計算過程中無必要地失敗，且訊息不明確。這時最有效的一個排除步驟就是：

> **將設計從 EDB 匯出 ANF ，再重新匯入進行模擬**。

此模式如同“重置資料格式以清掃電腦内容”，優點包括：

* 改用成簡化格式，不帶過多的關聯資料
* 手動重新匯入 stackup / cmp 等關鍵設定
* 採用新模擬總是新程序或成熟排程，增加成功機率

![2025-05-11_16-02-03](/assets/2025-05-11_16-02-03.png)

### 三、實務演習：使用 ANF 重置模擬

1. 打開存在問題的Siwave 設計
2. 匯出:

   * 選擇 Export > ANF (Generic)
   * 匯出stackup 系統 (.xml)
   * 匯出元件檔 (.cmp)
3. 重新開啟 SIwave > Import ANF
4. 重新設定:
   * Import Stackup (.xml)
   * Import Component Models (.cmp)
   * Assign Ports
   * Setup Simulation
5. 重新執行模擬

有許多原先在 EDB 模擬環境下無法順利運行、甚至無明確錯誤提示的案例，改用 ANF 重建設計後皆可順利完成模擬。這些案例包含：S參數元件模型無法正確連結、layout 中遺留未清除的 net 或元件、stackup 不一致導致場解器崩潰等。透過 ANF 重新匯入，這些潛在問題常可被有效排除，進而完成模擬。


### 結論

.ANF 格式在 SIwave 應用中雖然陳舊，但非但無用。它是一個優雅的「資料篩選器」，能夠排除 GUI 與系統資料中的陰障，對於多年經驗的使用者而言，是一個必備的除錯技巧。
