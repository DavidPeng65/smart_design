建立SIwave專屬電容元件庫
---
在 SIwave 中使用 S 參數（散射參數）是為了準確描述高頻元件在不同頻率下的行為。隨著電子產品操作頻率不斷提升，傳統的理想電容或電感模型已無法準確反映實際元件的電磁效應。透過 S 參數，可量測或模擬出元件在各頻率下的反射（S11）與傳輸（S21）特性，提供真實的頻域響應。SIwave 將 S 參數模型套用至被動元件，可提升模擬精度，準確評估阻抗匹配、訊號完整性（SI）與電源完整性（PI）等高頻特性，是高速電路設計中不可或缺的重要工具。

### 標準做法：手動指派S參數
在 Ansys SIwave 中，「SPICE/S-param Vendor Model Assignment」工具（紅色框選處）可用來將實際量測的 S-參數模型（.s2p 檔案） 指派給設計中的 RLC 元件。使用者可透過此工具選取設計中的被動元件，並為其套用來自廠商或自建的 S-參數模型，以更準確反映其頻率響應特性。此功能對於高頻電路模擬特別重要，可有效提升模擬精度與結果可信度。整體流程簡單明確，是 SIwave 中建模與驗證常用的關鍵功能。
![2025-05-19_10-32-26](/assets/2025-05-19_10-32-26.png)

點擊按鈕開啟下面視窗。使用者可透過左下角的 Import S-parameter Model 按鈕，開啟右側紅框中的設定視窗。此視窗可填入元件類型（如 Capacitor）、指定 .s2p 檔案位置，並設定廠牌（Vendor）、系列（Series）、零件名稱（Part Name）、容值（Capacitance）、封裝尺寸（EIA Size）、額定電壓與容差等資訊，作為元件特徵的比對依據。

特別的是，使用者可選擇 S 參數的量測架構，常見為 Shunt（上下引腳）或 Series（左右引腳）模式，以符合實際元件的測試方法。

![2025-05-19_10-35-26](/assets/2025-05-19_10-35-26.png)

使用者在左側選取目標元件後，點擊此功能即可開啟右側的篩選介面，進行模型搜尋與比對。篩選條件包含：製造商（Manufacturer）、系列名稱（Series）、零件型號（Part）、封裝尺寸（Size）與容值範圍（Value Range），並可進一步指定最小品質因子（Min Quality）來篩選高品質模型。

搜尋結果會依條件顯示所有匹配的元件模型，包括其 ESL（等效串聯電感）、ESR（等效串聯電阻）與 Loss Factor 等關鍵參數，供使用者挑選最合適的模型進行套用。

![2025-05-19_10-41-46](/assets/2025-05-19_10-41-46_k5bbn7gnm.png)

這種手動指派 S-參數模型的方法雖簡單易懂，但當元件數量眾多時，將面臨效率低下與易出錯的問題。對於數十到數百顆以上的電容或電感，逐一操作非常耗時且難以管理。為解決此問題，SIwave 提供兩種自動化方式：一是使用 Auto Match By Value 功能，依據容值與封裝尺寸自動配對模型；二是透過 Import Part Matching File，批次匯入配對資料表，自動將元件與對應的 .s2p 模型綁定。此方式可大幅提升效率，並確保配對準確性，適用於大規模設計流程。

### 進階1. 建立元件庫

首先，將所有 .s2p 檔案集中至Personlib之下路徑，例如：\PersonalLib\Unlocked\Capacitors\Ansys\simulation。這個資料夾會作為 SIwave 載入 Vendor 模型的來源。

接著，針對每個 .s2p 檔案建立對應的 .rlc 檔（同名但副檔名為 .rlc），其內容需包含基本元件資訊，例如：
```
1e-07       ← Capacitance（F）
0
0
SERIES       ← 測試模式（SERIES 或 SHUNT）
0201         ← 封裝尺寸（EIA）
NA
NA
10
dc
```
此檔案結構對應 SIwave 中 Vendor Model 的導入欄位，代表容值、封裝、測試方式等資訊。完成後，重啟 SIwave 並於 SIwave 中開啟 SPICE/S-param Vendor Model Assignment 工具，即可自動辨識所有模型，


![2025-05-19_10-53-37](/assets/2025-05-19_10-53-37.png)

### 進階2. 指定型號與元件庫對應
為有效管理大量元件與其對應的 S 參數模型，SIwave 提供 `*.pmap` 映射檔功能，能一次性批次指派所有元件與對應的 S 參數資料。使用者可透過建立如圖所示的 `caps.pmap` 檔案，每一行對應一組映射關係，格式為：

```
[Local Part Name] [Type] [Vendor] [Part Name]
```

例如：

```
0402C_1_1e-07farad Capacitor Ansys GRM155C81E104KA12
```

代表將電路中的 `0402C_1_1e-07farad` 元件對應到 `Ansys` 廠商所提供的 `GRM155C81E104KA12.s2p` 模型。當所有 S 參數與對應的 `.rlc` 描述檔放置於 `PersonalLib` 指定資料夾中後，進入 SIwave 的「SPICE/S-parameter Vendor Component Management」工具，點選 `Import Part Matching File` 即可一鍵匯入這些關聯設定。

這種方式特別適合有大量電容、電感元件需要對應 S 參數的設計流程，能大幅提升效率，減少錯誤率，並利於日後維護與自動化流程整合。


![2025-05-19_10-55-48](/assets/2025-05-19_10-55-48.png)

### 自動化之可能

在 SIwave 的設計流程中，針對大量被動元件建立對應的元件庫與 S 參數映射關係，透過 Python 腳本可大幅提升效率與準確性。首先，可根據每個 .s2p 檔案的命名規則，自動剖析出電容值與封裝尺寸，並自動產生對應的 .rlc 描述檔。每個 .rlc 檔案內容皆可根據模板填入正確資訊，如容值、封裝、測試類型（SERIES 或 SHUNT）等，避免手動錯誤。

接著，腳本亦可自動建立 .pmap 映射檔，用於告訴 SIwave 每個設計元件（如 0402C_1_1e-07farad）應對應哪一個 S 參數模型（如 GRM155C81E104KA12）。只要模型與描述檔放置在正確資料夾，匯入 .pmap 即可一次完成所有對應。

此流程適合研發部門內部建構標準元件庫與自動化模擬流程，亦可搭配版本控制與批次更新機制，確保模型資料一致性與可追蹤性，大幅降低人力操作負擔。